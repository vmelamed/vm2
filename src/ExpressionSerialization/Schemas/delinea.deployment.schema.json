{
  "$id": "https://delinea.com/engine-pool/deployment.options.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Deployment Options",
  "description": "Defines the various data elements associated with a workload deployment, e.g. selector, tolerations, settings and secrets templates, etc.",
  "type": "object",
  "properties": {
    "description": {
      "description": "Free form text describing this deployment.",
      "type": "string"
    },
    "workload": {
      "description": "Reference to the workload that this deployment is part of. If a workload with the specified 'serviceNamespace' and 'name' does not exist, Delinea.EnginePool.Engine.Deployment.Cli will create it.",
      "type": "object",
      "properties": {
        "serviceNamespace": {
          "description": "The service namespace of the workload, e.g. Delinea.EnginePool",
          "type": "string",
          "pattern": "^[^<>:\"/\\|?*~]{1,63}$"
        },
        "name": {
          "description": "The name of the workload, e.g. WorkloadExample",
          "type": "string",
          "pattern": "^[^<>:\"/\\|?*~]{1,63}$"
        },
        "description": {
          "description": "Free form text description of the workload. If specified, Deployment.Cli will set/update the workload's description to this value.",
          "type": "string"
        },
        "displayName": {
          "description": "Text that will be used as a friendly display name in the UI for the workload. If specified, Deployment.Cli will set/update the workload's displayName to this value.",
          "type": "string"
        },
        "kbLink": {
          "description": "Name of the kbLink to documentation for the workload. If specified, Deployment.Cli will set/update the workload's kbLink to this value.",
          "type": "string"
        },
        "featureFlag": {
          "description": "Optional value to control whether a workload should be sent to an engine. If this value exists, the tenant must have this feature flag enabled to recieve this workload.",
          "type": "string"
        }
      },
      "required": [
        "serviceNamespace",
        "name"
      ]
    },
    "versionString": {
      "description": "The semantic version (https://semver.org) of the deployment.",
      "type": "string",
      "pattern": "^(?:0|(?:[1-9][0-9]*))\\.(?:0|(?:[1-9][0-9]*))\\.(?:0|(?:[1-9][0-9]*))(?:\\-(?:(?:(?:0|(?:[1-9][0-9]*)))|(?:\\d*[\\-A-Za-z][\\-0-9A-Za-z]*))(?:\\.(?:(?:(?:0|(?:[1-9][0-9]*)))|(?:\\d*[\\-A-Za-z][\\-0-9A-Za-z]*)))*)?(?:\\+(?:(?:(?:0|(?:[1-9][0-9]*)))|(?:\\d*[\\-A-Za-z][\\-0-9A-Za-z]*))(?:\\.(?:(?:(?:0|(?:[1-9][0-9]*)))|(?:\\d*[\\-A-Za-z][\\-0-9A-Za-z]*)))*)?$"
    },
    "packageFilename": {
      "description": "The filename (without the path) of the deployment package. Must be an archive of type 'tar', with 'gz' compression, no top level folder.",
      "type": "string"
    },
    "selectors": {
      "description": "A dictionary of selectors (set of key-value pairs). The engine must have a dictionary of labels (also a set of key-value pairs) that is a superset of the selectors for this deployment to be considered a candidate for scheduling.",
      "type": "object",
      "patternProperty": {
        "^(?!.{254,})(?:(?:[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)(?<!.{254,})/)?(?:[a-zA-Z0-9](?:[a-zA-Z0-9_.-]{0,61}[a-zA-Z0-9])?)?$": {
          "description": "The value of the selector. The engine must have a label with the same name and the same value.",
          "type": "string",
          "pattern": ".{0,63}"
        }
      }
    },
    "tolerations": {
      "description": "A list of tolerations. The engine must have matching taints for each selector, in order for this deployment to be considered as a candidate to be scheduled.",
      "type": "array",
      "items": {
        "description": "Toleration objects that must be matched by the engine taints for the engine to consider this deployment a candidate to be scheduled.",
        "type": "object",
        "properties": {
          "key": {
            "description": "The key of the toleration. The engine must have a taint with the same key.",
            "type": "string",
            "pattern": "^(?!.{254,})(?:(?:[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)(?<!.{254,})/)?[a-zA-Z0-9](?:[a-zA-Z0-9_.-]{0,251}[a-zA-Z0-9])?$"
          },
          "value": {
            "description": "The value of the toleration (can be null or empty). The engine must have a taint with the same key. If the 'operation' property is 'exists' (the values are ignored); otherwise (if the 'operation' is 'equal'), the values of the taint and the toleration also must be the same.",
            "type": "string",
            "pattern": ".{0,63}"
          },
          "effect": {
            "description": "Determines the action that should be taken in case the deployment is running or scheduled to run but the toleration has no matching taint.",
            "type": "string",
            "enum": [
              "PreferNoSchedule",
              "NoSchedule",
              "NoExecute"
            ]
          },
          "operator": {
            "description": "Modifies how the taint-toleration matching is done: if set to 'exists', test only for key existence; otherwise ('equal') tests key existence and the values equality",
            "type": "string",
            "enum": [
              "Equal",
              "Exists"
            ]
          }
        },
        "required": [
          "key",
          "value",
          "effect",
          "operator"
        ]
      },
      "uniqueItems": true
    },
    "processEnvironmentVariables": {
      "description": "A dictionary of environment variables (name-value pairs) required for the proper running of the deployment.",
      "type": "object",
      "patternProperty": {
        "^[^=?*{}\\[\\]]+$": {
          "description": "The names of the the environment variables cannot be empty and must consist of any printable characters, except: '=?*{}[]'",
          "type": "string"
        }
      }
    },
    "processEntryPoint": {
      "description": "The entry point of the deployment executable, e.g. 'myWorkload.exe'",
      "type": "string"
    },
    "processParameters": {
      "description": "Command line parameters to the deployment",
      "type": "string"
    },
    "settings": {
      "description": "A set of templates for Delinea settings.",
      "type": "array",
      "items": {
        "description": "The set of Delinea setting templates.",
        "type": "object",
        "properties": {
          "key": {
            "description": "The key of the setting - used by the deployment to reference the setting.",
            "type": "string",
            "pattern": "^(?:\\S.*)?\\S$"
          },
          "name": {
            "description": "The human readable name of the setting - for UI use only.",
            "type": "string"
          },
          "valueType": {
            "description": "The type of the setting.",
            "type": "string",
            "enum": [
              "string",
              "integer",
              "number",
              "boolean",
              "uuid",
              "dateTimeIso8601",
              "secretpicker",
              "password"
            ]
          },
          "description": {
            "description": "Free form text describing the setting.",
            "type": "string"
          },
          "defaultValue": {
            "description": "Default value of the setting.",
            "type": "string"
          }
        },
        "required": [
          "key",
          "name",
          "valueType"
        ]
      },
      "uniqueItems": true
    },
    "secrets": {
      "description": "A set of templates for Delinea secrets.",
      "type": "array",
      "items": {
        "description": "The set of Delinea secrets templates.",
        "type": "object",
        "properties": {
          "key": {
            "description": "The key of the secret - used by the deployment to reference the secret.",
            "type": "string",
            "pattern": "^(?:\\S.*)?\\S$"
          },
          "name": {
            "description": "The human readable name of the secret - for UI use only.",
            "type": "string"
          },
          "description": {
            "description": "Free form text describing the secret.",
            "type": "string"
          }
        },
        "required": [
          "key",
          "name"
        ]
      },
      "uniqueItems": true
    },
    "deprecated": {
      "description": "If 'true', marks the deployment as deprecated.",
      "type": [ "boolean", "string", "integer" ],
      "pattern": "^(?:[Ff][Aa][Ll][Ss][Ee])|(?:[Tt][Rr][Uu][Ee])|(?:0|1)$"
    },
    "featureFlag": {
      "description": "Optional value to control whether a deployment should be sent to an engine. If this value exists, the tenant must have this feature flag enabled to recieve this deployment.",
      "type": "string"
    }
  },
  "required": [
    "workload",
    "versionString",
    "packageFilename",
    "processEntryPoint"
  ]
}
 